
SimplePS(Production System)
========================================

簡単なプロダクションシステム以後(PS)を作ってみました。

プロダクションシステム
----------------------------------------

なるべく汎用的な設計を目指しました。

### ワーキングメモリ内の情報の文法

ワーキングメモリに保存される情報をテキストデータ
として表現する時の形式は次のようになる(実際のところ
テキストデータとして表現する必要が出てくることは
ないかもしれないけと一応定めておく)。

    情報名1:値1 情報名2:値2 ... 情報名n:値n

つまり情報名と値のペアの集合である。これは
変数名と値と言った方がわかりやすいかもしれないが，
下のルールで使用する変数と区別するために情報名という
言葉を使うことにする。
情報名は任意の文字列で日本語も可。値は
数字か文字列のどちらか。数字の場合はそのまま
記述し，文字列の場合は **必ず** 引用符(\"か\')で
囲むものとする。数字の記述は1や5などの整数の
形式や1.0や5.0または1.5E10などの実数形式が
可能である。ただし，このPSでは簡単のため全ての
数字は実数として処理する(つまり1と書いた場合は
1.0と解釈される)。特殊な場合として値が無いとか
必要無いことを示すためにnullを指定できるものとする。
情報と情報の間は空白で区切るが，空白のかわりに
コンマ(,)も可。

### ルールの文法

ルールは以下の記法になる。

    /* コメント行 */
    優先度: 条件1 条件2 ... 条件m > 実行部1 実行部2 ... 実行部n ;

優先度とそれ以降がコロン(:)で区切られ各条件間は
空白で区切られ，条件部と実行部の間は大なり記号(>)で
区切られ，各実行部間は空白で区切られ，最後はセミコロン(;)で
終る。上は一つのルールを一行で書いたが，適当な場所で
改行しても良い。また，`/*`と`*/`でコメント文字とし，
文字コードはUTF8を使用すること。実は条件間，実行部間はコンマを
入れて区切ってもOK。

優先度は正の整数でなければならない。
数字のおおきい方が優先度が高いものとする。
優先度が同じだった場合はルールの登録順
(ソースから読み込むとすればファイルの上の方)
が優先されるものとする。それから，一度実行された
ルールは，条件が更新されないかぎり再び実行されない
ようにしている。

のこりの条件iや実行部jは全て関数の形式の記述
になる。関数は次の形式になる。

    関数名(引数1 引数2 ... 引数n)

関数名はその関数の働きを表す文字列。引数には
数字か文字列か変数名が使用できる。文字列は
引用符で囲むものとする。引数間は空白で区切る。
空白のかわりにコンマ(,)を使用することも可。
条件部でも実行部でも
利用可能な関数の全てが使用できるが，条件部で
ワーキングメモリを操作するような関数を使用すると
混乱することになると思うので非推奨。

補足：変数は宣言などする必要がなく初めて出現した
時に自動的に作成される。また，変数の型もないので，
数字でも文字でも入れられる。

### 関数一覧

このPSの関数は必ず真か偽の値を返す。その真偽値
が何かの判定結果を表すものを条件判定関数と呼ぶ。
単に何かの処理を行い失敗がありえないような
関数を処理関数と呼ぶ。処理関数の返り値は必ず
真である。(処理関数でも実行時例外が発生する
場合があるが，これはエラーということで別に
処理する)

#### 条件判定関数

* s(引数1) //sはsearchのs
    + 引数1には変数を指定しなければならない。
      ワーキングメモリの中に引数1の変数名と
      同名の情報が入っている時には真，入って
      いない場合は偽を出力する。さらに変数には
      該当する情報の値が代入される。
* no(引数1) // noはnot storedのno
    + 引数1に指定された変数の変数名と同じ情報が
      ワーキングメモリに存在しない場合に真，
      存在する場合には偽を返す関数
* gt(引数1,引数2)
    + 引数1が引数2よりも大きい時に真，
      そうでない場合に偽となる
* lt(引数1,引数2)
    + 引数1が引数2よりも小さい時に真，
      そうでない場合に偽となる
* ge(引数1,引数2)
    + 引数1が引数2以上の時に真，
      そうでない場合に偽となる
* le(引数1,引数2)
    + 引数1が引数2以下の時に真，
      そうでない場合に偽となる
* eq(引数1,引数2)
    + 引数1と引数2が等しいかどうか判定する。
      引数1と引数2の値の型は一致していなければ
      ならない(つまり文字列が等しいかどうかの
      判定にも使える)。数字の場合で計算誤差が
      心配な場合は次のrangeを使った方が良いかもしれない
* neq(引数1,引数2)
    + 引数1と引数2が異なるかどうか判定する。
      引数1と引数2の値の型は一致していなければ
      ならない(つまり文字列が等しいかどうかの
      判定にも使える)。数字の場合で計算誤差が
      心配な場合は次のrangeを使った方が良いかもしれない
* range(引数1,引数2,引数3)
    + 引数1が引数2と引数3の間の数値かどうか
      判定する。境界は含めない。
      引数2<引数3でない場合は例外を発生する。
* range2(引数1,引数2,引数3)
    + 引数1が引数2と引数3の間の数値かどうか
      判定する。境界も含む。
      引数2<=引数3でない場合は例外を発生する。
* seq(引数1,引数2)
    + seq(引数1,引数2) = s(引数1) eq(引数1,引数2)
* sneq(引数1,引数2)
    + seq(引数1,引数2) = s(引数1) neq(引数1,引数2)
* sgt(引数1,引数2)
    + sgt(引数1,引数2) = s(引数1) gt(引数1,引数2)
* slt(引数1,引数2)
    + slt(引数1,引数2) = s(引数1) lt(引数1,引数2)
* sge(引数1,引数2)
    + sge(引数1,引数2) = s(引数1) ge(引数1,引数2)
* sle(引数1,引数2)
    + sle(引数1,引数2) = s(引数1) le(引数1,引数2)

#### 処理関数

* set(引数1,引数2)
    + 引数1に変数を指定し，引数2に何らかの値を
      指定することで，変数に値を代入する。
      この操作は変数の操作であってワーキング
      メモリには影響しないことに注意。
* st(引数1) //stはstoreのst
    + 引数1に変数を指定することで，ワーキング
      メモリに情報をセットする。セットされる
      情報の情報名は変数名と同じ。すでに同じ名前の
      情報名の情報が存在する場合には値が上書きされる。
      値が代入されていない変数もセットすることが
      可能で，その場合には値としてnullがセットされる。
* st2(引数1,引数2) //stはstoreのst
    + 引数1に変数名，引数2に値を指定することで，
      ワーキングメモリに情報をセットする。つまり
      set関数とst関数の省略形。
* del(引数1)
    + 引数1で変数を指定することで，
      ワーキングメモリにある情報を削除
      する。ワーキングメモリに該当する
      情報が無い場合には何もしない。
* add(引数1,引数2,引数3)
    + 引数1,引数2には数字か変数を指定。
      引数3は変数を指定。
      引数1と引数2の合計を計算して引数3に
      代入する。
* sub(引数1,引数2,引数3)
    + 引数1,引数2には数字か変数を指定。
      引数3は変数を指定。
      引数1から引数2をひいた値を引数3に
      代入する。
* mul(引数1,引数2,引数3)
    + 引数1,引数2には数字か変数を指定。
      引数3は変数を指定。
      引数1と引数2の積を計算して引数3に代入する。
* div(引数1,引数2,引数3)
    + 引数1,引数2には数字か変数を指定。
      引数3は変数を指定。
      引数1を引数2で割った値を計算して引数3に代入する。
* mod(引数1,引数2,引数3)
    + 引数1,引数2には数字か変数を指定。
      引数3は変数を指定。
      引数1を引数2で割った余りを計算して引数3に代入する。
* floor(引数1,引数2)
    + 引数1は数字か変数を指定。引数2は変数を指定。
      引数1の小数点を切り捨てた値を引数2に代入する。
* concat(引数1,引数2,引数3)
    + 引数1の文字列と引数2の文字列を結合
      して引数3の変数に代入する
* log(引数1,引数2,...)
    + 引数1,引数2,...の内容を標準出力に
      出力する。引数が文字列や数字の場合には
      そのまま，変数の場合にはその値が出力される。
      主にデバッグなどの目的で使用する。
* rand(引数1)
    + 引数1に[0.0-1.0]の乱数を代入する。
      引数1は変数でなければならない。
* stop()
    + プロダクションシステムのループ処理を強制終了する。
* wm()
    + ワーキングメモリの内容をコンソールにダンプする。

